# BDDサンプルプロジェクト

このプロジェクトは、PHPでBDD（振る舞い駆動開発）を実践するためのサンプルコードです。技術書「PHP で始める振る舞い駆動開発（Behaviour-Driven Development）」の内容を実際に試すことができます。

## 概要

レジシステムを例として、以下のBDDの要素を体験できます：

- **Gherkin**によるシナリオ記述
- **Behat**によるBDDテストの実行
- **PHPUnit**によるアサーション
- 振る舞いを意識したテストコードの作成

## 前提条件

- PHP 8.0以上
- Composer
- 基本的なPHPの知識

## クイックスタート

### 1. プロジェクトのクローン・移動

```bash
# このディレクトリに移動
cd book/manuscripts/uutan1108/sample

# または、新しいディレクトリにコピーして試す場合
cp -r book/manuscripts/uutan1108/sample ~/bdd-sample
cd ~/bdd-sample
```

### 2. 依存関係のインストール

```bash
# 必要なパッケージをインストール
composer install
```

### 3. テストの実行

```bash
# Behatテストを実行
vendor/bin/behat
```

## 期待される結果

テストが成功すると、以下のような出力が表示されます：

```
Feature: レジシステムでの商品購入
  As a 店員
  I can 商品をスキャンして合計金額を計算する
  so that 顧客が正確な金額を確認できる

  Scenario: 複数の商品を購入する
    Given レジシステムを起動する
    When "りんご" を "2" 個 スキャンする
    And "みかん" を "1" 個 スキャンする
    Then 合計金額は "400" 円 であること

1 個のシナリオ (1 個成功)
4 個のステップ (4 個成功)
0m0.01s
```

## プロジェクト構造

```
bdd-sample/
├── README.md                 # このファイル
├── composer.json            # Composer設定
├── composer.lock            # 依存関係のロックファイル
├── vendor/                  # Composerでインストールされたパッケージ
├── features/                # Behatフィーチャーファイル
│   ├── register.feature    # レジシステムのシナリオ
│   └── bootstrap/          # コンテキストクラス
│       └── FeatureContext.php
└── src/                     # 実装コード
    └── RegisterSystem.php   # レジシステムクラス
```

## ファイルの説明

### `features/register.feature`

Gherkin形式で記述されたレジシステムのシナリオです。自然言語で「何を」「どのように」「期待する結果」を記述しています。

### `features/bootstrap/FeatureContext.php`

Gherkinのステップを実際のテストコードに変換するクラスです。各ステップに対応するメソッドが定義されています。

### `src/RegisterSystem.php`

テスト対象となるレジシステムの実装クラスです。商品の追加と合計金額の計算を行います。

## 動作の流れ

1. **レジシステムの起動**: 新しいレジシステムインスタンスを作成
2. **商品のスキャン**: りんご2個（150円×2=300円）を追加
3. **商品のスキャン**: みかん1個（100円×1=100円）を追加
4. **合計金額の検証**: 合計400円（300円+100円）であることを確認

## カスタマイズ

### 新しい商品を追加

`src/RegisterSystem.php`の`$prices`配列に新しい商品と価格を追加できます：

```php
private array $prices = [
    'りんご' => 150,
    'みかん' => 100,
    'バナナ' => 200,
    'いちご' => 300  // 新しい商品を追加
];
```

### 新しいシナリオを追加

`features/register.feature`に新しいシナリオを追加できます：

```gherkin
Scenario: 単一商品の購入
  Given レジシステムを起動する
  When "バナナ" を "1" 個 スキャンする
  Then 合計金額は "200" 円 であること
```

## トラブルシューティング

### よくある問題

**Q: `composer install`でエラーが発生する**
A: PHPのバージョンが8.0以上であることを確認してください。

**Q: `vendor/bin/behat`でコマンドが見つからない**
A: `composer install`が正常に完了していることを確認してください。

**Q: テストが失敗する**
A: ファイルの内容が技術書の内容と一致していることを確認してください。

## 次のステップ

このサンプルを理解したら、以下のことに挑戦してみてください：

1. **新しい機能の追加**: 商品の削除機能、割引機能など
2. **より複雑なシナリオ**: 複数顧客、返品処理など
3. **データ駆動テスト**: 異なる商品と数量の組み合わせ
4. **Webアプリケーション**: ブラウザベースのレジシステム

## 参考資料

- [Behat公式ドキュメント](https://docs.behat.org/)
- [PHPUnit公式ドキュメント](https://phpunit.de/)
- [Gherkin構文リファレンス](https://cucumber.io/docs/gherkin/)

## ライセンス

このサンプルコードは技術書の学習目的で提供されています。

---

**注意**: このサンプルは学習目的で作成されています。本格的なレジシステムとして使用する場合は、セキュリティ、エラーハンドリング、データベース連携などの実装が必要です。
